#!/usr/bin/env python

TYPE_SELF_REP   = 'm0'
TYPE_PERSIST    = 'm1'
TYPE_INJECTION  = 'm2'
TYPE_TMPEXE     = 'm3'

class Process:
    def __init__(self, pid=None, ppid=None, image=None):
        self.pid            = pid
        self.ppid           = ppid
        self.source_image   = image
        self.children       = []
        self.memory_map     = {}
    
    def set_parent(self, ppid):
        self.ppid = ppid

    def get_parent(self):
        return self.ppid

    def set_sourceimage(self, filename):
        self.source_image = filename

    def get_sourceimage(self):
        return self.source_image

    def add_child(self, child):
        if child not in self.children:
            self.children.append(child)

    def add_memory_map(self, filename, address):
        if address not in self.memory_map:
            self.memory_map[address] = filename

    def dump(self, tree):
        proc = {}
        proc['pid']             = self.pid
        proc['source_image']    = self.source_image
        proc['file_created']    = []
        proc['file_written']    = []
        proc['file_deleted']    = []
        proc['children']        = []

        for filename in tree.file_created:
            if tree.file_created[filename].pid == self.pid:
                proc['file_created'].append(filename)

        for filename in tree.file_written:
            if tree.file_written[filename].pid == self.pid:
                proc['file_written'].append(filename)

        for filename in tree.file_deleted:
            if tree.file_deleted[filename].pid == self.pid:
                proc['file_deleted'].append(filename)

        for child in self.children:
            proc['children'].append(tree.processes[child].dump(tree))

        return proc
